<!-- üé§ USER MANAGEMENT INTERFACE - IDOL AGENCY TYCOON -->

<!-- Login/Register Modal -->
<div id="userModal" class="user-modal">
    <div class="user-modal-content">
        <div class="user-modal-header">
            <span class="close-user-modal" onclick="closeUserModal()">&times;</span>
            <div class="user-modal-title">
                <div class="modal-icon">üé§</div>
                <h2>Gestiona tu Agencia</h2>
                <p>Sincroniza tu progreso entre todos tus dispositivos</p>
            </div>
        </div>
        
        <div class="user-modal-body">
            <!-- Login Form -->
            <div id="loginForm" class="user-form active">
                <h3>Iniciar Sesi√≥n</h3>
                
                <button class="social-login-btn google-btn" onclick="handleGoogleLogin()">
                    <span class="social-icon">üîç</span>
                    Continuar con Google
                </button>
                
                <div class="divider">
                    <span>o</span>
                </div>
                
                <form onsubmit="handleEmailLogin(event)">
                    <div class="input-group">
                        <input type="email" id="loginEmail" placeholder="Email" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
                    </div>
                    <button type="submit" class="login-btn">Iniciar Sesi√≥n</button>
                </form>
                
                <div class="form-footer">
                    <p>¬øNo tienes cuenta? <a href="#" onclick="showRegisterForm()">Reg√≠strate aqu√≠</a></p>
                    <p><a href="#" onclick="showGuestMode()">Continuar como invitado</a></p>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="user-form">
                <h3>Crear Cuenta</h3>
                
                <button class="social-login-btn google-btn" onclick="handleGoogleLogin()">
                    <span class="social-icon">üîç</span>
                    Registrarse con Google
                </button>
                
                <div class="divider">
                    <span>o</span>
                </div>
                
                <form onsubmit="handleEmailRegister(event)">
                    <div class="input-group">
                        <input type="text" id="registerName" placeholder="Nombre de usuario" required>
                    </div>
                    <div class="input-group">
                        <input type="email" id="registerEmail" placeholder="Email" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="registerPassword" placeholder="Contrase√±a" required minlength="6">
                    </div>
                    <button type="submit" class="register-btn">Crear Cuenta</button>
                </form>
                
                <div class="form-footer">
                    <p>¬øYa tienes cuenta? <a href="#" onclick="showLoginForm()">Inicia sesi√≥n aqu√≠</a></p>
                    <p><a href="#" onclick="showGuestMode()">Continuar como invitado</a></p>
                </div>
            </div>
            
            <!-- User Profile -->
            <div id="userProfile" class="user-form">
                <h3>Mi Perfil</h3>
                <div class="user-info">
                    <div class="user-avatar">
                        <img id="userAvatar" src="" alt="Avatar">
                        <div id="userInitials" class="user-initials"></div>
                    </div>
                    <div class="user-details">
                        <h4 id="userDisplayName">Usuario</h4>
                        <p id="userEmail">email@ejemplo.com</p>
                        <div class="user-stats">
                            <span class="stat-item">
                                <strong id="userFame">0</strong> ‚≠ê Fama
                            </span>
                            <span class="stat-item">
                                <strong id="userLevel">1</strong> üè¢ Nivel
                            </span>
                            <span class="stat-item">
                                <strong id="userIdols">0</strong> üë• Idols
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="user-actions">
                    <button class="action-btn sync-btn" onclick="syncGameData()">
                        <span>üîÑ</span> Sincronizar Ahora
                    </button>
                    <button class="action-btn migrate-btn" onclick="migrateLocalData()">
                        <span>üì§</span> Migrar Datos Locales
                    </button>
                    <button class="action-btn leaderboard-btn" onclick="showLeaderboard()">
                        <span>üèÜ</span> Ver Rankings
                    </button>
                    <button class="action-btn logout-btn" onclick="handleLogout()">
                        <span>üö™</span> Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
            
            <!-- Guest Mode -->
            <div id="guestMode" class="user-form">
                <h3>Modo Invitado</h3>
                <div class="guest-info">
                    <div class="guest-icon">üë§</div>
                    <p>Juega sin crear cuenta. Tu progreso se guardar√° solo en este dispositivo.</p>
                    <div class="guest-limitations">
                        <h4>Limitaciones:</h4>
                        <ul>
                            <li>‚ùå Sin sincronizaci√≥n entre dispositivos</li>
                            <li>‚ùå Sin rankings globales</li>
                            <li>‚ùå Datos se pierden al limpiar navegador</li>
                        </ul>
                    </div>
                </div>
                
                <div class="guest-actions">
                    <button class="action-btn create-account-btn" onclick="showRegisterForm()">
                        <span>‚ú®</span> Crear Cuenta Gratis
                    </button>
                    <button class="action-btn continue-guest-btn" onclick="continueAsGuest()">
                        <span>üéÆ</span> Continuar Como Invitado
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Status Bar -->
<div id="userStatusBar" class="user-status-bar">
    <div class="user-status-info">
        <span id="userStatusIcon">üë§</span>
        <span id="userStatusText">Invitado</span>
        <span id="syncStatus" class="sync-status">üíæ</span>
    </div>
    <button class="user-status-btn" onclick="openUserModal()">
        <span>‚öôÔ∏è</span>
    </button>
</div>

<!-- Leaderboard Modal -->
<div id="leaderboardModal" class="leaderboard-modal">
    <div class="leaderboard-modal-content">
        <div class="leaderboard-header">
            <span class="close-leaderboard" onclick="closeLeaderboard()">&times;</span>
            <h2>üèÜ Rankings Globales</h2>
        </div>
        
        <div class="leaderboard-body">
            <div id="leaderboardList" class="leaderboard-list">
                <div class="loading-leaderboard">Cargando rankings...</div>
            </div>
        </div>
    </div>
</div>

<style>
/* üé§ USER MANAGEMENT STYLES */

.user-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 10000;
    align-items: center;
    justify-content: center;
}

.user-modal.active {
    display: flex;
}

.user-modal-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 0;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    position: relative;
    border: 2px solid rgba(255, 215, 0, 0.3);
}

.user-modal-header {
    background: rgba(255, 255, 255, 0.1);
    padding: 30px;
    text-align: center;
    border-radius: 20px 20px 0 0;
}

.close-user-modal {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 30px;
    cursor: pointer;
    color: #fff;
    transition: all 0.3s;
}

.close-user-modal:hover {
    color: #FFD700;
    transform: scale(1.2);
}

.modal-icon {
    font-size: 60px;
    margin-bottom: 15px;
    animation: modal-icon-pulse 2s infinite;
}

.user-modal-title h2 {
    font-size: 28px;
    margin-bottom: 10px;
    color: #FFD700;
}

.user-modal-title p {
    opacity: 0.9;
    font-size: 16px;
}

.user-modal-body {
    padding: 30px;
}

.user-form {
    display: none;
}

.user-form.active {
    display: block;
}

.user-form h3 {
    font-size: 24px;
    margin-bottom: 20px;
    text-align: center;
    color: #FFD700;
}

.social-login-btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 15px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.google-btn {
    background: #fff;
    color: #333;
}

.google-btn:hover {
    background: #f0f0f0;
    transform: translateY(-2px);
}

.social-icon {
    font-size: 20px;
}

.divider {
    text-align: center;
    margin: 20px 0;
    position: relative;
}

.divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.3);
}

.divider span {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 0 15px;
    color: #fff;
    font-size: 14px;
}

.input-group {
    margin-bottom: 15px;
}

.input-group input {
    width: 100%;
    padding: 15px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    font-size: 16px;
    transition: all 0.3s;
}

.input-group input:focus {
    outline: none;
    border-color: #FFD700;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
}

.input-group input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

.login-btn, .register-btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 15px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    color: #333;
}

.login-btn:hover, .register-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
}

.form-footer {
    text-align: center;
    margin-top: 20px;
}

.form-footer p {
    margin: 10px 0;
    opacity: 0.9;
}

.form-footer a {
    color: #FFD700;
    text-decoration: none;
    font-weight: bold;
}

.form-footer a:hover {
    text-decoration: underline;
}

/* User Profile Styles */
.user-info {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
}

.user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 3px solid #FFD700;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-initials {
    font-size: 24px;
    font-weight: bold;
    color: #333;
}

.user-details h4 {
    font-size: 20px;
    margin-bottom: 5px;
    color: #FFD700;
}

.user-details p {
    opacity: 0.8;
    margin-bottom: 15px;
}

.user-stats {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.stat-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 8px 12px;
    border-radius: 10px;
    font-size: 14px;
}

.user-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.action-btn {
    padding: 12px;
    border: none;
    border-radius: 15px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.action-btn:hover {
    background: rgba(255, 215, 0, 0.2);
    border-color: #FFD700;
    transform: translateY(-2px);
}

.sync-btn {
    background: linear-gradient(45deg, #4CAF50, #45a049);
}

.migrate-btn {
    background: linear-gradient(45deg, #2196F3, #1976D2);
}

.leaderboard-btn {
    background: linear-gradient(45deg, #FF9800, #F57C00);
}

.logout-btn {
    background: linear-gradient(45deg, #f44336, #d32f2f);
    grid-column: 1 / -1;
}

/* Guest Mode Styles */
.guest-info {
    text-align: center;
    margin-bottom: 30px;
}

.guest-icon {
    font-size: 60px;
    margin-bottom: 15px;
}

.guest-limitations {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 15px;
    margin-top: 20px;
}

.guest-limitations h4 {
    color: #FFD700;
    margin-bottom: 10px;
}

.guest-limitations ul {
    list-style: none;
    padding: 0;
}

.guest-limitations li {
    margin: 8px 0;
    opacity: 0.9;
}

.guest-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.create-account-btn {
    background: linear-gradient(45deg, #FFD700, #FFA500);
    color: #333;
}

.continue-guest-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
}

/* User Status Bar */
.user-status-bar {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border: 2px solid rgba(255, 215, 0, 0.3);
    transition: all 0.3s;
}

.user-status-bar:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: #FFD700;
}

.user-status-info {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: #fff;
}

.sync-status {
    font-size: 16px;
    animation: sync-pulse 2s infinite;
}

.user-status-btn {
    background: none;
    border: none;
    color: #FFD700;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.3s;
}

.user-status-btn:hover {
    transform: scale(1.2);
}

/* Leaderboard Modal */
.leaderboard-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 10001;
    align-items: center;
    justify-content: center;
}

.leaderboard-modal.active {
    display: flex;
}

.leaderboard-modal-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 30px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    position: relative;
    border: 2px solid rgba(255, 215, 0, 0.3);
}

.leaderboard-header {
    text-align: center;
    margin-bottom: 30px;
}

.close-leaderboard {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 30px;
    cursor: pointer;
    color: #fff;
    transition: all 0.3s;
}

.close-leaderboard:hover {
    color: #FFD700;
    transform: scale(1.2);
}

.leaderboard-header h2 {
    color: #FFD700;
    font-size: 28px;
}

.leaderboard-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.leaderboard-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.leaderboard-rank {
    font-size: 24px;
    font-weight: bold;
    color: #FFD700;
    min-width: 40px;
    text-align: center;
}

.leaderboard-user {
    flex: 1;
}

.leaderboard-user h4 {
    color: #fff;
    margin-bottom: 5px;
}

.leaderboard-user p {
    opacity: 0.8;
    font-size: 14px;
}

.leaderboard-stats {
    display: flex;
    gap: 15px;
}

.leaderboard-stat {
    text-align: center;
}

.leaderboard-stat .value {
    font-size: 18px;
    font-weight: bold;
    color: #FFD700;
}

.leaderboard-stat .label {
    font-size: 12px;
    opacity: 0.8;
}

.loading-leaderboard {
    text-align: center;
    padding: 40px;
    color: #FFD700;
    font-size: 18px;
}

/* Animations */
@keyframes modal-icon-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

@keyframes sync-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .user-modal-content {
        width: 95%;
        margin: 20px;
    }
    
    .user-status-bar {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
    }
    
    .user-actions {
        grid-template-columns: 1fr;
    }
    
    .user-stats {
        flex-direction: column;
        gap: 10px;
    }
    
    .leaderboard-stats {
        flex-direction: column;
        gap: 10px;
    }
}
</style>

<script>
// üé§ USER MANAGEMENT JAVASCRIPT

let currentUserForm = 'login';

// Modal Management
function openUserModal() {
    document.getElementById('userModal').classList.add('active');
    updateUserInterface();
}

function closeUserModal() {
    document.getElementById('userModal').classList.remove('active');
}

function showLoginForm() {
    currentUserForm = 'login';
    updateFormDisplay();
}

function showRegisterForm() {
    currentUserForm = 'register';
    updateFormDisplay();
}

function showGuestMode() {
    currentUserForm = 'guest';
    updateFormDisplay();
}

function updateFormDisplay() {
    document.querySelectorAll('.user-form').forEach(form => {
        form.classList.remove('active');
    });
    document.getElementById(currentUserForm + 'Form').classList.add('active');
}

// Authentication Handlers
async function handleGoogleLogin() {
    try {
        showLoading('Iniciando sesi√≥n con Google...');
        await signInWithGoogle();
        showSuccess('¬°Login exitoso!');
        closeUserModal();
    } catch (error) {
        showError('Error en login: ' + error.message);
    }
}

async function handleEmailLogin(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
        showLoading('Iniciando sesi√≥n...');
        await signInWithEmail(email, password);
        showSuccess('¬°Login exitoso!');
        closeUserModal();
    } catch (error) {
        showError('Error en login: ' + error.message);
    }
}

async function handleEmailRegister(event) {
    event.preventDefault();
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    try {
        showLoading('Creando cuenta...');
        await signUpWithEmail(email, password, name);
        showSuccess('¬°Cuenta creada exitosamente!');
        closeUserModal();
    } catch (error) {
        showError('Error en registro: ' + error.message);
    }
}

async function handleLogout() {
    try {
        showLoading('Cerrando sesi√≥n...');
        await signOut();
        showSuccess('Sesi√≥n cerrada');
        closeUserModal();
    } catch (error) {
        showError('Error cerrando sesi√≥n: ' + error.message);
    }
}

function continueAsGuest() {
    showSuccess('Continuando como invitado');
    closeUserModal();
}

// Data Management
async function syncGameData() {
    try {
        showLoading('Sincronizando datos...');
        await saveToCloud();
        showSuccess('¬°Datos sincronizados!');
    } catch (error) {
        showError('Error sincronizando: ' + error.message);
    }
}

async function migrateLocalData() {
    try {
        showLoading('Migrando datos locales...');
        await migrateLocalData();
        showSuccess('¬°Datos migrados exitosamente!');
    } catch (error) {
        showError('Error migrando datos: ' + error.message);
    }
}

// Leaderboard
async function showLeaderboard() {
    document.getElementById('leaderboardModal').classList.add('active');
    
    try {
        const leaderboard = await window.idolUserManager.getLeaderboard();
        displayLeaderboard(leaderboard);
    } catch (error) {
        document.getElementById('leaderboardList').innerHTML = 
            '<div class="loading-leaderboard">Error cargando rankings</div>';
    }
}

function closeLeaderboard() {
    document.getElementById('leaderboardModal').classList.remove('active');
}

function displayLeaderboard(leaderboard) {
    const list = document.getElementById('leaderboardList');
    
    if (leaderboard.length === 0) {
        list.innerHTML = '<div class="loading-leaderboard">No hay datos disponibles</div>';
        return;
    }
    
    list.innerHTML = leaderboard.map((user, index) => `
        <div class="leaderboard-item">
            <div class="leaderboard-rank">${index + 1}</div>
            <div class="leaderboard-user">
                <h4>${user.displayName}</h4>
                <p>Agencia Nivel ${user.agencyLevel}</p>
            </div>
            <div class="leaderboard-stats">
                <div class="leaderboard-stat">
                    <div class="value">${user.fame}</div>
                    <div class="label">‚≠ê Fama</div>
                </div>
                <div class="leaderboard-stat">
                    <div class="value">${user.idolsCount}</div>
                    <div class="label">üë• Idols</div>
                </div>
            </div>
        </div>
    `).join('');
}

// UI Updates
function updateUserInterface() {
    const userInfo = window.idolUserManager.getUserInfo();
    const isLoggedIn = window.idolUserManager.isUserLoggedIn();
    
    // Update status bar
    const statusIcon = document.getElementById('userStatusIcon');
    const statusText = document.getElementById('userStatusText');
    const syncStatus = document.getElementById('syncStatus');
    
    if (isLoggedIn && userInfo) {
        statusIcon.textContent = 'üë§';
        statusText.textContent = userInfo.displayName || 'Usuario';
        syncStatus.textContent = '‚òÅÔ∏è';
        
        // Update profile form
        document.getElementById('userDisplayName').textContent = userInfo.displayName || 'Usuario';
        document.getElementById('userEmail').textContent = userInfo.email;
        
        if (userInfo.photoURL) {
            document.getElementById('userAvatar').src = userInfo.photoURL;
            document.getElementById('userInitials').style.display = 'none';
        } else {
            document.getElementById('userAvatar').style.display = 'none';
            document.getElementById('userInitials').textContent = 
                (userInfo.displayName || 'U').charAt(0).toUpperCase();
        }
        
        // Update game stats if available
        if (window.gameState) {
            document.getElementById('userFame').textContent = window.gameState.fame || 0;
            document.getElementById('userLevel').textContent = window.gameState.agencyLevel || 1;
            document.getElementById('userIdols').textContent = window.gameState.idols?.length || 0;
        }
        
        currentUserForm = 'profile';
    } else {
        statusIcon.textContent = 'üë§';
        statusText.textContent = 'Invitado';
        syncStatus.textContent = 'üíæ';
        currentUserForm = 'login';
    }
    
    updateFormDisplay();
}

// Utility Functions
function showLoading(message) {
    // You can implement a loading indicator here
    console.log('Loading:', message);
}

function showSuccess(message) {
    // You can implement a success notification here
    console.log('Success:', message);
    if (window.showNotification) {
        window.showNotification(message);
    }
}

function showError(message) {
    // You can implement an error notification here
    console.log('Error:', message);
    if (window.showNotification) {
        window.showNotification('‚ùå ' + message);
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Update UI when user state changes
    setInterval(updateUserInterface, 5000);
});

console.log('üé§ User Interface loaded');
</script>
